<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[Hiro Kawasaki]]></title>
  <link href="http://kawahiro311.github.io/atom.xml" rel="self"/>
  <link href="http://kawahiro311.github.io/"/>
  <updated>2013-12-31T17:35:33+09:00</updated>
  <id>http://kawahiro311.github.io/</id>
  <author>
    <name><![CDATA[Hiro Kawasaki]]></name>
    
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    <title type="html"><![CDATA[Railsで連動プルダウン]]></title>
    <link href="http://kawahiro311.github.io/blog/2013/10/26/rails-interlock-pulldown/"/>
    <updated>2013-10-26T17:05:21+09:00</updated>
    <id>http://kawahiro311.github.io/blog/2013/10/26/rails-interlock-pulldown</id>
    <content type="html"><![CDATA[<p>都道府県を選んだら市区町村が絞り込まれるとかよくあるやつ。</p>

<p>今回は会社登録時に都道府県と市区町村をプルダウンで選べるみたいな設定で考える。</p>

<p>都道府県、市区町村、会社のモデルとそれぞれのリレーションはこんな感じ。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="c1"># ms_pref.rb</span>
</span><span class='line'><span class="k">class</span> <span class="nc">MsPref</span> <span class="o">&lt;</span> <span class="ss">ActiveRecord</span><span class="p">:</span><span class="ss">:Base</span>
</span><span class='line'>  <span class="n">has_many</span> <span class="ss">:ms_cities</span>
</span><span class='line'><span class="k">end</span>
</span><span class='line'>
</span><span class='line'><span class="c1"># ms_city.rb</span>
</span><span class='line'><span class="k">class</span> <span class="nc">MsCity</span> <span class="o">&lt;</span> <span class="ss">ActiveRecord</span><span class="p">:</span><span class="ss">:Base</span>
</span><span class='line'>  <span class="n">belongs_to</span> <span class="ss">:ms_pref</span>
</span><span class='line'><span class="k">end</span>
</span><span class='line'>
</span><span class='line'><span class="c1"># company.rb</span>
</span><span class='line'><span class="k">class</span> <span class="nc">Company</span> <span class="o">&lt;</span> <span class="ss">ActiveRecord</span><span class="p">:</span><span class="ss">:Base</span>
</span><span class='line'>  <span class="n">belongs_to</span> <span class="ss">:ms_pref</span>
</span><span class='line'>  <span class="n">belongs_to</span> <span class="ss">:ms_city</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>まずはviewで市区町村のプルダウンをpartial化する。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="c1"># _form.html.slim</span>
</span><span class='line'><span class="o">=</span> <span class="n">form_for</span> <span class="vi">@company</span> <span class="k">do</span> <span class="o">|</span><span class="n">f</span><span class="o">|</span>
</span><span class='line'>
</span><span class='line'>   <span class="p">(</span><span class="err">省略</span><span class="o">.</span><span class="n">.</span><span class="o">.</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>  <span class="o">.</span><span class="n">field</span>
</span><span class='line'>    <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">label</span> <span class="ss">:ms_pref</span>
</span><span class='line'>    <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">collection_select</span> <span class="ss">:ms_pref</span><span class="p">,</span> <span class="no">MsPref</span><span class="o">.</span><span class="n">all</span><span class="p">,</span> <span class="ss">:id</span><span class="p">,</span> <span class="ss">:name</span>
</span><span class='line'>  <span class="o">.</span><span class="n">field</span>
</span><span class='line'>    <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">label</span> <span class="ss">:ms_city</span>
</span><span class='line'>    <span class="c1">#cities_select</span>
</span><span class='line'>      <span class="o">=</span> <span class="n">render</span> <span class="ss">partial</span><span class="p">:</span> <span class="s1">&#39;cities&#39;</span><span class="p">,</span> <span class="ss">locals</span><span class="p">:</span> <span class="p">{</span><span class="n">ms_pref_id</span><span class="p">:</span> <span class="no">MsPref</span><span class="o">.</span><span class="n">first</span><span class="o">.</span><span class="n">id</span><span class="p">}</span>
</span><span class='line'>
</span><span class='line'>   <span class="p">(</span><span class="err">省略</span><span class="o">.</span><span class="n">.</span><span class="o">.</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'><span class="c1">#  _cities.html.slim</span>
</span><span class='line'><span class="o">=</span> <span class="n">collection_select</span> <span class="ss">:company</span><span class="p">,</span> <span class="ss">:ms_city</span><span class="p">,</span> <span class="no">MsCity</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">ms_pref_id</span><span class="p">:</span> <span class="n">ms_pref_id</span><span class="p">),</span> <span class="ss">:id</span><span class="p">,</span> <span class="ss">:name</span>
</span></code></pre></td></tr></table></div></figure>


<p>都道府県の変更を検知するためのjquery(coffeescript)を書く。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="c1"># companies.js.coffee</span>
</span><span class='line'><span class="err">$</span><span class="p">(</span><span class="n">document</span><span class="p">)</span><span class="o">.</span><span class="n">on</span> <span class="s1">&#39;change&#39;</span><span class="p">,</span> <span class="s1">&#39;#company_ms_pref&#39;</span><span class="p">,</span> <span class="o">-&gt;</span>
</span><span class='line'>  <span class="vg">$.</span><span class="n">ajax</span><span class="p">(</span>
</span><span class='line'>    <span class="ss">type</span><span class="p">:</span> <span class="s1">&#39;GET&#39;</span>
</span><span class='line'>    <span class="ss">url</span><span class="p">:</span> <span class="s1">&#39;/companies/cities_select&#39;</span>
</span><span class='line'>    <span class="ss">data</span><span class="p">:</span> <span class="p">{</span>
</span><span class='line'>      <span class="n">ms_pref_id</span><span class="p">:</span> <span class="err">$</span><span class="p">(</span><span class="n">this</span><span class="p">)</span><span class="o">.</span><span class="n">val</span><span class="p">()</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>  <span class="p">)</span><span class="o">.</span><span class="n">done</span> <span class="p">(</span><span class="n">data</span><span class="p">)</span> <span class="o">-&gt;</span>
</span><span class='line'>    <span class="err">$</span><span class="p">(</span><span class="s1">&#39;#cities_select&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">html</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>あとは、ajaxでの値うけとり先のroutesの設定とcontrollerでそのメソッド定義して処理すれば完成！</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="c1"># routes.rb</span>
</span><span class='line'><span class="n">resources</span> <span class="ss">:companies</span> <span class="k">do</span>
</span><span class='line'>  <span class="n">collection</span> <span class="k">do</span>
</span><span class='line'>    <span class="n">get</span> <span class="ss">:cities_select</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span><span class='line'>
</span><span class='line'><span class="c1"># companies_controller.rb</span>
</span><span class='line'><span class="k">def</span> <span class="nf">cities_select</span>
</span><span class='line'>  <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">xhr?</span>
</span><span class='line'>    <span class="n">render</span> <span class="ss">partial</span><span class="p">:</span> <span class="s1">&#39;cities&#39;</span><span class="p">,</span> <span class="ss">locals</span><span class="p">:</span> <span class="p">{</span><span class="n">ms_pref_id</span><span class="p">:</span> <span class="n">params</span><span class="o">[</span><span class="ss">:ms_pref_id</span><span class="o">]</span><span class="p">}</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>Rails楽しいー♡</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[2011年の振り返りと、2012年]]></title>
    <link href="http://kawahiro311.github.io/blog/2011/01/04/look-back-2011-n-2012/"/>
    <updated>2011-01-04T17:22:26+09:00</updated>
    <id>http://kawahiro311.github.io/blog/2011/01/04/look-back-2011-n-2012</id>
    <content type="html"><![CDATA[<h2>2011年</h2>

<p>2011年4月の頃、とあるベンチャーでインターンをしていた中で、静的なコンテンツを作る機会に巡りあいました。</p>

<p>その当時はhtmlすらナニソレみたいな状況で、調べながら作ったそれは全く凄いものでもないけど、<strong>創ることの面白さ</strong>を実際に肌で触れた貴重な経験でした。</p>

<p>また次第に、自分が考えたアイデアが自分で作れないこと、自分がイイと思ったアイデアがリリースされていくことに自分自身への苛立ちを感じるようになりました。</p>

<p>そんな形でだんたんと、使う側から作る側になりたいと思い始めました。</p>

<p>そんな中、フィリピンで出会った<a href="http://langrich.com/">赤い会社</a>でのインターンが、これからたぶん作る側として生きていく中で原点となったと思います。</p>

<p>html,cssを分かった気でいた若造が、自分の実務レベルでの使えなさを知り、業務を通じて、unixのコマンド, emacs, cakephpなどのフレームワーク, gitなどのバージョン管理システム, プロジェクト管理などなどウェブについてたくさん新しいことを覚えました。</p>

<p>もちろんウェブについて以外のことも、あのチームからたくさんのことを学ばせてもらいました。</p>

<p> </p>

<p>2011年は、ウェブにどっぶり浸かり始めた1年でした。</p>

<p>2012年は、勉強のための勉強だけではなく、何かサービスを作る中でたくさんのことを学ぶ1年にしたいと思っています。</p>

<h2>2012年達成したいこと(目標)</h2>

<ul>
<li>サービスをリリースする</li>
</ul>


<p>1人でもそうだけど、チームとして何かやってみたい!</p>

<ul>
<li>自作PC</li>
</ul>


<p>これはまじでやる!たぶんubuntuにすると思うけど、linuxの何かをいれよーと思う。</p>

<ul>
<li>toeic900点突破</li>
</ul>


<p>toeicとか実際の英語力と関係ないじゃんとか思ってたけど、具体的な目標として。</p>

<ul>
<li>自作サーバー</li>
</ul>


<p>これはまだわかんないけど、興味ある。音とかがネックだな。</p>

<p>あとはgithubにどんどん作ったもの上げていきたいと思います!</p>

<p>それでは、今年もよろしくお願いします:)</p>
]]></content>
  </entry>
  
</feed>
